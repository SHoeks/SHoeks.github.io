#!/bin/zsh

resize_img () {
    img_w=$(identify -format "%w" "$1")
    img_h=$(identify -format "%h" "$1")
    set_w=$2; 
    set_h=$(echo "($set_w/($img_w/$img_h))" | bc -l); 
    set_h=`printf "%.0f" $(echo $set_h | bc)`
    echo $set_w"x"$set_h
    convert -resize $set_w"x"$set_h "$1" "${1%%.*}_$set_w.jpg"   
    convert -quality 90 "${1%%.*}_$set_w.jpg" "${1%%.*}_$set_w.webp"
    if [[ $3 == "webp" ]]; then 
        rm -f "${1%%.*}_$set_w.jpg"
    fi
}

# desktop: width / height > 1
echo "Desktop:"
resize_img $1 2500 "jpg+webp"
resize_img $1 2400 "webp"
resize_img $1 2300 "webp"
resize_img $1 2200 "webp"
resize_img $1 2100 "webp"
resize_img $1 2000 "webp"
resize_img $1 1900 "webp"
resize_img $1 1800 "webp"
resize_img $1 1700 "webp"
resize_img $1 1600 "webp"
resize_img $1 1500 "webp"
resize_img $1 1400 "webp"
resize_img $1 1300 "webp"
resize_img $1 1200 "webp"
resize_img $1 1100 "webp"
resize_img $1 1000 "webp"
resize_img $1 900 "webp"
resize_img $1 800 "webp"
resize_img $1 700 "webp"
resize_img $1 600 "webp"
resize_img $1 500 "webp"
resize_img $1 400 "webp"
resize_img $1 300 "webp"
resize_img $1 200 "webp"
resize_img $1 100 "webp"

# tablet: width / height > 0.7
echo "Tablet:"
convert "${1%%.*}_2500.jpg" -shave 400x0 "${1%%.*}_tablet.jpg"
cp "${1%%.*}_tablet.jpg" "${1%%.*}_tablet_2500.jpg"
resize_img "${1%%.*}_tablet.jpg" 2400 "webp"
resize_img "${1%%.*}_tablet.jpg" 2300 "webp"
resize_img "${1%%.*}_tablet.jpg" 2200 "webp"
resize_img "${1%%.*}_tablet.jpg" 2100 "webp"
resize_img "${1%%.*}_tablet.jpg" 2000 "webp"
resize_img "${1%%.*}_tablet.jpg" 1900 "webp"
resize_img "${1%%.*}_tablet.jpg" 1800 "webp"
resize_img "${1%%.*}_tablet.jpg" 1700 "webp"
resize_img "${1%%.*}_tablet.jpg" 1600 "webp"
resize_img "${1%%.*}_tablet.jpg" 1500 "webp"
resize_img "${1%%.*}_tablet.jpg" 1400 "webp"
resize_img "${1%%.*}_tablet.jpg" 1300 "webp"
resize_img "${1%%.*}_tablet.jpg" 1200 "webp"
resize_img "${1%%.*}_tablet.jpg" 1100 "webp"
resize_img "${1%%.*}_tablet.jpg" 1000 "webp"
resize_img "${1%%.*}_tablet.jpg" 900 "webp"
resize_img "${1%%.*}_tablet.jpg" 800 "webp"
resize_img "${1%%.*}_tablet.jpg" 700 "webp"
resize_img "${1%%.*}_tablet.jpg" 600 "webp"
resize_img "${1%%.*}_tablet.jpg" 500 "webp"
resize_img "${1%%.*}_tablet.jpg" 400 "webp"
resize_img "${1%%.*}_tablet.jpg" 300 "webp"
resize_img "${1%%.*}_tablet.jpg" 200 "webp"
resize_img "${1%%.*}_tablet.jpg" 100 "webp"

# mobile: width / height < 0.7
echo "Mobile:"
convert "${1%%.*}_2500.jpg" -shave 650x0 "${1%%.*}_mobile.jpg"
cp "${1%%.*}_mobile.jpg" "${1%%.*}_mobile_2500.jpg"
resize_img "${1%%.*}_mobile.jpg" 2400 "webp"
resize_img "${1%%.*}_mobile.jpg" 2300 "webp"
resize_img "${1%%.*}_mobile.jpg" 2200 "webp"
resize_img "${1%%.*}_mobile.jpg" 2100 "webp"
resize_img "${1%%.*}_mobile.jpg" 2000 "webp"
resize_img "${1%%.*}_mobile.jpg" 1900 "webp"
resize_img "${1%%.*}_mobile.jpg" 1800 "webp"
resize_img "${1%%.*}_mobile.jpg" 1700 "webp"
resize_img "${1%%.*}_mobile.jpg" 1600 "webp"
resize_img "${1%%.*}_mobile.jpg" 1500 "webp"
resize_img "${1%%.*}_mobile.jpg" 1400 "webp"
resize_img "${1%%.*}_mobile.jpg" 1300 "webp"
resize_img "${1%%.*}_mobile.jpg" 1200 "webp"
resize_img "${1%%.*}_mobile.jpg" 1100 "webp"
resize_img "${1%%.*}_mobile.jpg" 1000 "webp"
resize_img "${1%%.*}_mobile.jpg" 900 "webp"
resize_img "${1%%.*}_mobile.jpg" 800 "webp"
resize_img "${1%%.*}_mobile.jpg" 700 "webp"
resize_img "${1%%.*}_mobile.jpg" 600 "webp"
resize_img "${1%%.*}_mobile.jpg" 500 "webp"
resize_img "${1%%.*}_mobile.jpg" 400 "webp"
resize_img "${1%%.*}_mobile.jpg" 300 "webp"
resize_img "${1%%.*}_mobile.jpg" 200 "webp"
resize_img "${1%%.*}_mobile.jpg" 100 "webp"